(use 'std/net.ae')

(let server (create-server 8080))
(if (unit? server)
  (println 'ERROR: Could not create server')
  (exit 1))

(let current-client unit)

(while true
  (let new-client (accept-connection server 8080))
  (if new-client
    (set current-client new-client)
    (send new-client 'Hello, Network!'))

  (if current-client
    (let request (receive current-client))
    (if request
      (println request)
      (close-connection current-client)
      (set current-client unit)))

  (sleep 0.01))
